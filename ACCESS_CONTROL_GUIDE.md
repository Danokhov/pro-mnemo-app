# Руководство по настройке контроля доступа

## Описание

Система контроля доступа позволяет ограничивать доступ пользователей к темам в зависимости от их Telegram ID.

## Как это работает

1. **Telegram ID** - уникальный идентификатор пользователя в Telegram
2. **Конфигурация доступа** - файл `src/config/accessConfig.ts` содержит настройки доступа
3. **Уровни доступа**:
   - `'all'` - полный доступ ко всем темам
   - `['topic-id-1', 'topic-id-2']` - доступ только к указанным темам

## Как получить Telegram ID пользователя

### Способ 1: Через консоль браузера
1. Откройте приложение в Telegram
2. Нажмите F12 (или откройте DevTools)
3. В консоли введите:
```javascript
window.Telegram.WebApp.initDataUnsafe.user.id
```
4. Скопируйте полученное число - это Telegram ID

### Способ 2: Через бота @userinfobot
1. Откройте бота @userinfobot в Telegram
2. Отправьте команду `/start`
3. Бот покажет ваш Telegram ID

### Способ 3: Добавить временный лог в код
В файле `src/services/authService.ts` можно добавить временный лог:
```typescript
console.log('Telegram ID:', tgUser.id);
```

## Настройка доступа

Откройте файл `src/config/accessConfig.ts` и настройте доступ:

### Пример 1: Полный доступ для одного пользователя
```typescript
export const ACCESS_CONFIG: AccessConfig = {
  '123456789': 'all', // Пользователь с ID 123456789 имеет полный доступ
};
```

### Пример 2: Доступ только к одной теме
```typescript
export const ACCESS_CONFIG: AccessConfig = {
  '987654321': ['doctor-visit'], // Пользователь с ID 987654321 имеет доступ только к теме "Приём у врача"
};
```

### Пример 3: Доступ к нескольким темам
```typescript
export const ACCESS_CONFIG: AccessConfig = {
  '111222333': ['doctor-visit', 'house-cleaning'], // Доступ к двум темам
};
```

### Пример 4: Разные уровни доступа для разных пользователей
```typescript
export const ACCESS_CONFIG: AccessConfig = {
  '123456789': 'all', // Полный доступ
  '987654321': ['doctor-visit'], // Только одна тема
  '111222333': ['doctor-visit', 'house-cleaning'], // Несколько тем
};
```

## ID тем (topic IDs)

Список доступных тем и их ID:
- `doctor-visit` - Приём у врача (Der Termin beim Arzt)
- `house-cleaning` - Уборка в доме (Das Putzen zu Hause)
- (добавьте другие темы по мере их создания)

## Поведение по умолчанию

- Если пользователь **не указан** в конфигурации, у него **полный доступ** ко всем темам
- Если пользователь **указан** в конфигурации, применяются правила доступа из конфигурации

## Ограничение доступа по умолчанию

Если вы хотите, чтобы по умолчанию доступ был ограничен, измените функцию `hasAccessToTopic` в `src/config/accessConfig.ts`:

```typescript
export function hasAccessToTopic(telegramId: string, topicId: string): boolean {
  const userAccess = ACCESS_CONFIG[telegramId];
  
  if (!userAccess) {
    return false; // Изменить на false для ограничения доступа по умолчанию
  }
  
  // ... остальной код
}
```

## Проверка работы

1. Получите Telegram ID пользователя
2. Добавьте его в конфигурацию с ограниченным доступом
3. Откройте приложение от имени этого пользователя
4. Проверьте, что видны только разрешенные темы
5. Попробуйте открыть недоступную тему - должно появиться сообщение об ограничении доступа

## Важные замечания

- **Telegram ID - это число**, не строка (но в конфигурации используется как строка для ключа объекта)
- После изменения конфигурации нужно **пересобрать и задеплоить** приложение
- Конфигурация хранится в коде, поэтому изменения требуют нового деплоя
- Для динамического управления доступом (без деплоя) потребуется бэкенд и база данных

## Безопасность

⚠️ **Важно**: Текущая реализация хранит конфигурацию доступа в клиентском коде. Это означает:
- Пользователи могут увидеть конфигурацию в исходном коде
- Для серьезных приложений рекомендуется использовать серверную проверку доступа

Для продакшена рекомендуется:
1. Хранить конфигурацию доступа на сервере
2. Проверять доступ через API
3. Использовать токены доступа или подписи Telegram

